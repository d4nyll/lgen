<template name="ClassDetail">

  {{#contentFor "headerTitle"   }}
    {{#if atTop}}
        <h1 class="title">{{classObj.className}}@{{classObj.classCode}} </h1> 
    {{else}}
        <h1 class="title title-twoline">
            <span>{{classObj.className}}</span>
            <br/><span class='description-plain'>{{teacherName}}</span>
        </h1>    
    {{/if}}
  {{/contentFor}}

  {{#contentFor "headerButtonLeft"}}
    {{>ionNavBackButton text=" " href="/Classes" }}
  {{/contentFor}}



  {{#contentFor "headerButtonRight"}}



    <div style="position: absolute; right: 0;">

      <a href="{{pathFor 'ClassInformation'  classCode=classObj.classCode  }}"
         class="button button-clear button-entering button-active "><i class="icon ion-ios-information-outline"></i></a>
      <!-- <button  class="button button-clear button-entering button-active addClassBtn">?</button> -->
    </div>
  {{/contentFor}}


  {{#ionView}}
    {{#ionContent class='background-wallpaper class-detail'}}
    
    
    <a class="item item-icon-left assertive" href="#">
        <i class="icon e1a-{{teacherAvatar}} e1a-1x emojicon"></i>
       <h2>{{teacherName}}</h2>
       <p>{{_ "Teacher"}}</p>
    </a>     
   


      {{#with getMessagesObj}}
         {{#with messagesGroupByDate this}}

         {{#each this}}
            {{#each this}}
                {{#if isFirstMessageInADate @index}}
                       <div class='date-bubble-wrapper'> <div class='date-bubble'>{{formatDate sendAt}}</div> </div>
                {{/if}}                       
                <div class="list card less-top-bottom-padding less-top-bottom-margin">
                     
                <!-- <div class="item ">
                    <div class="row" style="padding:0">
                        <div class="col" style="padding:0"><h2>{{getClassName}}</h2></div>
                        <div class="col" style="padding:0;text-align:right">{{createdAt}}</div>
                    </div>
                    </div>-->

                    <div class="item less-top-bottom-padding">
                    <div>
                        {{{docPreview content}}}                     
                        {{#autolink}}<span class='content'><pre>{{content}}</pre></span>{{/autolink}}
                    </div>
                    <div>
                        <div>
                        {{#if havePic}}
                            {{#each imageArr}}
                            {{#with getImage}}
                                {{#if this.isUploaded}}
                                {{#if this.hasStored 'images'}}
                                    <div class="">
                                    <img src="{{this.url store='thumbs'  }}" alt="" class="imgThumbs responsive-img"
                                        data-fullsizeimage="{{this.url  }}">
                                    <!-- <a class="button button-icon icon ion-close-circled image" data-imgid="{{_id}}"></a> -->
                                    </div>
                                {{/if}}
                                {{/if}}
                            {{/with}}
                            {{/each}}
                        {{/if}}
                        </div>
                        <div>
                        {{#if haveSound}}
                            {{#each soundArr}}
                            {{#with getSound}}
                                {{#if this.isUploaded}}
                                {{#if this.hasStored 'sounds'}}
                                    {{#if  this.url}}
                                    {{#if isCordova}}
                                        <div class="bubble">
                                        <a class="button button-icon icon ion-play playBtn" data-clipid="{{_id}}"></a>
                                        <!-- <a class="button button-icon icon ion-close-circled voice" data-clipid="{{_id}}"></a> -->
                                        </div>                    
                                    {{else}}
                                        <div class="bubble">
                                        <audio controls>
                                            <source src="{{this.url}}" type="audio/wav">
                                        </audio>
                                        <!-- <a class="button button-icon icon ion-close-circled voice" data-clipid="{{_id}}"></a> -->
                                        </div>                                                                                    
                                    {{/if}}
                                    {{/if}} 
                                {{/if}}
                                {{/if}}
                            {{/with}}
                            {{/each}}
                        {{/if}}
                        </div>
                        <div class='document'>
                        {{#if haveDocument}}
                            {{#each documentArr}}
                            {{#with getDocument}}
                                {{#if this.isUploaded}}
                                {{#if this.hasStored 'documents'}}                           
                                    <div class="bubble">
                                    <a href='{{this.url}}'> <i class="icon ion-ios-download-outline"></i>&nbsp;{{this.name}}</a>
                                    <br/><span  class='timestamp'>{{formatTime  ../sendAt}}</span>                       
                                    </div>                                   
                                {{/if}}                      
                                {{/if}}
                            {{/with}}
                            {{/each}}
                        {{/if}}                      
                        </div>                
                    </div>
                    

                    <p>
                        {{#if star}}
                            {{#if isNotEmpty star}}
                            <a href="#" class="subdued">{{star.length}} <i class="ion-ios-star colored"></i></a>
                            {{/if}}
                            {{#if isNotEmpty checked}}
                            <a href="#" class="subdued">{{checked.length}} <i class="ion-checkmark-round colored"></i></a>
                            {{/if}}
                            {{#if isNotEmpty close}}
                            <a href="#" class="subdued">{{close.length}} <i class="ion-close-round colored"></i></a>
                            {{/if}}
                            {{#if isNotEmpty help}}
                            <a href="#" class="subdued">{{help.length}} <i class="ion-help colored"></i></a>
                            {{/if}}                        
                        {{else}}
                            {{> VoteDisplay this.vote}}                       
                        {{/if}}
                        <span class='timestamp'>{{formatTime sendAt}}</span>  
                    </p>
                    </div>
                    
                    <!--Voting Area-->                  
                    <div class="item tabs tabs-secondary tabs-icon-left">
                    {{#if star}}
                        <a class="tab-item" data-msgId={{msgId}} data-action="checked" href="#">
                            <i class="icon ion-checkmark-round {{isSelectAction checked}}"></i>
                        </a>
                        <a class="tab-item" data-msgId={{msgId}} data-action="close" href="#">
                            <i class="icon ion-close-round {{isSelectAction close}}"></i>
                        </a>
                        <a class="tab-item" data-msgId={{msgId}} data-action="star" href="#">
                            <i class="icon ion-ios-star {{isSelectAction star}}"></i>
                        </a>
                        <a class="tab-item" data-msgId={{msgId}} data-action="help" href="#">
                            <i class="icon ion-help {{isSelectAction help}}"></i>
                        </a>                   
                    {{else}}
                         {{> VoteChange vote=this.vote messageId=msgId}}                     
                    {{/if}}
                        
                    </div>
                    <!--Voting Area End-->
                    
                    <!--Display existing comments-->
                    {{#with this.comment}}
                        {{#each this.comments}}
                            <!--TODO: show full comments list on another page, limit number of comments on this page-->
                            <div class="item less-top-bottom-padding {{@index}}">
                             {{#if this.isShown}}
                                {{this.comment}} by {{this.createdBy}} at {{this.createdAt}}
                             {{else}}
                                This comment is hidden.
                             {{/if}}
                            </div>
                        {{/each}}
                    {{/with}}
                    <!--Display existing comments end-->

                    <!--Add comment-->
                    
                        <div class="item item-input-inset">
                            <label class="item-input-wrapper">
                                <input type="text" class="" placeholder="What you think?">
                            </label>
                            <button class='button button-small button-positive add-comment-annoucement'>Comment</button>
                        </div>                    
                    
                    <!--Add comment end-->
                                        
                    
                </div>
                {{/each}}
            {{/each}}

            {{else}}

                <div class="item">
                {{_ "No_message_yet"}}
                </div>

        {{/with}}
      {{/with}}
    {{/ionContent}}
  {{/ionView}}
</template>
