<template name="ChatRoom">

  {{#contentFor "headerTitle"}}
    <h1 class="title">
      <i class="icon e1a-{{getGroupOrCorrespondentAvatar}} e1a-2x emojicon"></i>
      {{getName}}
    </h1>
  {{/contentFor}}

  {{#contentFor "headerButtonLeft"}}
    {{>ionNavBackButton href="/chat" text=" "}}
  {{/contentFor}}

  {{#contentFor "headerButtonRight"}}
    <!-- <div style="position: absolute; right: 0;">
    <a href="{{pathFor 'classEdit'  }}"  class="button button-clear button-entering button-active "><i class="icon ion-ios-information-outline"></i></a>
  </div> -->
  {{/contentFor}}



  {{#ionView}}
    {{#ionContent}}

    
      <div class="list chatroomList background-wallpaper" id="chatroomList">
        {{#with chatRoomMessageGroupByDate chatRoomProfile.messagesObj}}
           {{#each this}}
                
                {{#each this}}
          {{#if isFirstMessageInADate @index}}
                 <div class='date-bubble'>{{formatDate sendAt}}</div>
          {{/if}}          
          <div class="item {{isMine}}">
            {{#if isText}}
              <div class="bubble">
                {{#if isMineBoolean from}}
                {{else}}
                    {{#with getUserById from}}
                        <div class='username'><i class="icon e1a-{{profile.useravatar}} e1a-1x emojicon"></i>{{profile.firstname}}</div><br/>
                    {{/with}}
                {{/if}}                 
                {{{docPreview text}}}                
                {{#autolink}}<pre>{{text}}</pre>{{/autolink}}

                <span class='timestamp'>{{formatTime sendAt}}</span>
               
              </div>

            {{/if}}
            {{#if isDocument}}
                 {{#with getDocument}}  
                        {{#if this.isUploaded}}
                             {{#if this.hasStored 'documents'}}
                                <div class="bubble">
                                {{#if isMineBoolean ../from}}
                                {{else}}
                                    {{#with getUserById ../from}}
                                        <div class='username'><i class="icon e1a-{{profile.useravatar}} e1a-1x emojicon"></i>{{profile.firstname}}</div><br/>
                                    {{/with}}
                                {{/if}}                                          
                                <a href='{{this.url}}'> <i class="icon ion-ios-download-outline"></i>&nbsp;{{this.name}}</a>
                                <br/><span  class='timestamp'>{{formatTime  ../sendAt}}</span>                       
                                </div>
                              {{else}}
                                   {{> LoadingSpinner}}                                                          
                             {{/if}}
                        {{else}}
                             {{> LoadingSpinner}}
                        {{/if}}                               
                 {{/with}}        
            {{/if}}
            {{#if isImage}}
              {{#with FS.GetFile "images" this.image}}
              
              <!--read the below to know how to access parent scope value-->
              <!--https://www.discovermeteor.com/blog/a-guide-to-meteor-templates-data-contexts/-->  
              <style>.bubble.image-bubble.image{{@index}}:after{content:"{{formatTime  ../sendAt}}";white-space: nowrap;}</style>
                <div class="bubble image-bubble image{{@index}}">
                {{#if isMineBoolean ../from}}
                {{else}}
                    {{#with getUserById ../from}}
                        <div class='username'><i class="icon e1a-{{profile.useravatar}} e1a-1x emojicon"></i>{{profile.firstname}}</div><br/>
                    {{/with}}
                {{/if}}                        
                  <!--http://stackoverflow.com/questions/10426786/div-gets-extra-height-for-no-reason-->
                  <img style='display:block;' src="{{this.url store='thumbs'  }}" alt="" class="imgThumbs responsive-img" data-fullsizeimage="{{this.url  }}"> 
                </div>
              {{/with}}

            {{/if}}
            {{#if isSound}}
              {{#with getSound}}
                {{#if this.isUploaded}}
                  {{#if this.hasStored 'sounds'}}
                    {{#if  this.url}}
                      {{#if isCordova}}
                        <div class="bubble sound-bubble">
                        {{#if isMineBoolean ../from}}
                        {{else}}
                            {{#with getUserById ../from}}
                                <div class='username'><i class="icon e1a-{{profile.useravatar}} e1a-1x emojicon"></i>{{profile.firstname}}</div><br/>
                            {{/with}}
                        {{/if}}                                  
                          <a class="button button-icon icon ion-play playBtn" data-clipid="{{_id}}"></a>
                          <br/><span  class='timestamp'>{{formatTime  ../sendAt}}</span>                       
                        </div>                      
                      {{else}}
                        <div class="bubble sound-bubble">
                        {{#if isMineBoolean ../from}}
                        {{else}}
                            {{#with getUserById ../from}}
                                <div class='username'><i class="icon e1a-{{profile.useravatar}} e1a-1x emojicon"></i>{{profile.firstname}}</div><br/>
                            {{/with}}
                        {{/if}}                                  
                          <audio controls>
                            <source src="{{this.url}}" type="audio/wav">
                          </audio>
                          <br/><span  class='timestamp'>{{formatTime  ../sendAt}}</span>                       
                        </div>                       
                      {{/if}}

                    {{/if}}
                  {{/if}}
                {{/if}}
              {{/with}}
            {{/if}}
          </div>        
        
                {{/each}}
           {{/each}}
        {{/with}}        
      </div>

      <div class="list inputBoxList">

        {{#if targertWorkingTime}}
          <div class="item " style="text-align:center">
            <i class="icon ion-clock"></i> {{_ "Itisworkofftime"}}
          </div>
        
        {{else}}

        <div class="item item-input chatroomItem">
          <textarea style="" dir="auto" name="msg" maxlength="5000"
                    class="inputBox autogrow-short" placeholder=""></textarea>
          <button style="min-height:0;border:0;padding:0;margin:0;border-radius:6px;width:100px;display:none;" class="sendBtn button icon  ion-paper-airplane "></button>
          <span class='mediaButtonGroup' style='display:inherit;'>
               
                <span class="file " style='display:inline-block;padding:10px;padding-right:20px;'>
                  <i class="icon ion-ios-upload-outline imageIcon"></i>
                  <input type="file" id="documentBtn" accept=".pdf, .doc, .docx, .ppt, .pptx, .xls , .xlsx">
                </span>       
                         
                <span class="file " style='display:inline-block;padding:10px;padding-right:20px;{{withExtraRightPadding}}'>
                  <i class="icon ion-ios-camera-outline imageIcon "></i>
                  <input type="file" id="imageBtn" accept="image/*;capture=camera" capture="camera">
                </span>
          
                {{#if isCordova}}
                  <span class="file voice" style='display:inline-block;padding:10px;padding-right:40px;'>
                    <i class="icon  ion-ios-mic-outline "></i>
                  </span>
                {{/if}}
                
          </span>
        </div>
        {{/if}}
      </div>



    {{/ionContent}}
  {{/ionView}}


</template>

<template name="imageModal">
  {{#ionModal title="" }}
    <div class="row row-center" style="height:100%">
      <div class="col" style="text-align: center;">
        <img src="{{src}}" alt="" style="max-width:100%">
      </div>
    </div>
  {{/ionModal}}
</template>
